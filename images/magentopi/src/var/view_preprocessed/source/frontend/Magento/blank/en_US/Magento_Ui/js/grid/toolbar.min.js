define(['underscore','Magento_Ui/js/lib/view/utils/async','Magento_Ui/js/lib/view/utils/raf','rjsResolver','uiCollection'],function(_,$,raf,resolver,Collection){'use strict';var transformProp;transformProp=(function(){var style=document.documentElement.style,base='Transform',vendors=['webkit','moz','ms','o'],vi=vendors.length,property;if(typeof style.transform!='undefined'){return'transform';}
while(vi--){property=vendors[vi]+base;if(typeof style[property]!='undefined'){return property;}}})();function locate(elem,x,y){var value='translate('+x+'px,'+y+'px)';elem.style[transformProp]=value;}
return Collection.extend({defaults:{template:'ui/grid/toolbar',stickyTmpl:'ui/grid/sticky/sticky',tableSelector:'table',columnsProvider:'ns = ${ $.ns }, componentType = columns',refreshFPS:15,sticky:false,visible:false,_resized:true,_scrolled:true,_tableScrolled:true,_requiredNodes:{'$stickyToolbar':true,'$stickyTable':true,'$table':true,'$sticky':true},stickyClass:{'sticky-header':true}},initialize:function(){this._super();if(this.sticky){this.waitDOMElements().then(this.run.bind(this));}
return this;},waitDOMElements:function(){var _domPromise=$.Deferred();_.bindAll(this,'setStickyTable','setTableNode');$.async({ctx:':not([data-role="sticky-el-root"])',component:this.columnsProvider,selector:this.tableSelector},this.setTableNode);$.async({ctx:'[data-role="sticky-el-root"]',component:this.columnsProvider,selector:this.tableSelector},this.setStickyTable);this._domPromise=_domPromise;return _domPromise.promise();},setLeftCap:function(node){this.$leftCap=node;},setRightCap:function(node){this.$rightCap=node;},setTableNode:function(node){this.$cols=node.tHead.children[0].cells;this.$tableContainer=node.parentNode;this.setNode('$table',node);},setStickyTable:function(node){this.$stickyCols=node.tHead.children[0].cells;this.setNode('$stickyTable',node);},setStickyToolbarNode:function(node){this.setNode('$stickyToolbar',node);},setStickyNode:function(node){this.setNode('$sticky',node);},setToolbarNode:function(node){this.$toolbar=node;},setNode:function(key,node){var nodes=this._requiredNodes,promise=this._domPromise,defined;this[key]=node;defined=_.every(nodes,function(enabled,name){return enabled?this[name]:true;},this);if(defined){resolver(promise.resolve,promise);}},run:function(){_.bindAll(this,'refresh','_onWindowResize','_onWindowScroll','_onTableScroll');$(window).on({scroll:this._onWindowScroll,resize:this._onWindowResize});$(this.$tableContainer).on('scroll',this._onTableScroll);this.refresh();this.checkTableWidth();},refresh:function(){if(!raf(this.refresh,this.refreshFPS)){return;}
if(this._scrolled){this.onWindowScroll();}
if(this._tableScrolled){this.onTableScroll();}
if(this._resized){this.onWindowResize();}
if(this.visible){this.checkTableWidth();}},show:function(){this.visible=true;this.$sticky.style.display='';this.$toolbar.style.visibility='hidden';return this;},hide:function(){this.visible=false;this.$sticky.style.display='none';this.$toolbar.style.visibility='';return this;},isCovered:function(){var stickyTop=this._stickyTableTop+this._wScrollTop;return stickyTop>this._tableTop;},updateStickyTableOffset:function(){var style,top;if(this.visible){top=this.$stickyTable.getBoundingClientRect().top;}else{style=this.$sticky.style;style.visibility='hidden';style.display='';top=this.$stickyTable.getBoundingClientRect().top;style.display='none';style.visibility='';}
this._stickyTableTop=top;return this;},updateTableOffset:function(){var box=this.$table.getBoundingClientRect(),top=box.top+this._wScrollTop;if(this._tableTop!==top){this._tableTop=top;this.onTableTopChange(top);}
return this;},checkTableWidth:function(){var cols=this.$cols,total=cols.length,rightBorder=cols[total-2].offsetLeft,tableWidth=this.$table.offsetWidth;if(this._tableWidth!==tableWidth){this._tableWidth=tableWidth;this.onTableWidthChange(tableWidth);}
if(this._rightBorder!==rightBorder){this._rightBorder=rightBorder;this.onColumnsWidthChange();}
return this;},updateTableWidth:function(){this.$stickyTable.style.width=this._tableWidth+'px';if(this._tableWidth<this._toolbarWidth){this.checkToolbarSize();}
return this;},updateColumnsWidth:function(){var cols=this.$cols,index=cols.length,stickyCols=this.$stickyCols;while(index--){stickyCols[index].width=cols[index].offsetWidth;}
return this;},checkToolbarSize:function(){var width=this.$tableContainer.offsetWidth;if(this._toolbarWidth!==width){this._toolbarWidth=width;this.onToolbarWidthChange(width);}
return this;},updateVisibility:function(){if(this.visible!==this.isCovered()){this.visible?this.hide():this.show();}
return this;},updateLeftCap:function(){locate(this.$leftCap,-this._wScrollLeft,0);return this;},updateRightCap:function(){var left=this._toolbarWidth-this._wScrollLeft;locate(this.$rightCap,left,0);return this;},updateTableScroll:function(){var container=this.$tableContainer,left=container.scrollLeft+this._wScrollLeft;locate(this.$stickyTable,-left,0);return this;},updateToolbarWidth:function(){this.$stickyToolbar.style.width=this._toolbarWidth+'px';return this;},onToolbarWidthChange:function(){this.updateToolbarWidth().updateRightCap();},onTableTopChange:function(){this.updateStickyTableOffset();},onTableWidthChange:function(){this.updateTableWidth();},onColumnsWidthChange:function(){this.updateColumnsWidth();},onWindowResize:function(){this.checkToolbarSize();this._resized=false;},onTableScroll:function(){this.updateTableScroll();this._tableScrolled=false;},onWindowScroll:function(){var scrollTop=window.pageYOffset,scrollLeft=window.pageXOffset;if(this._wScrollTop!==scrollTop){this._wScrollTop=scrollTop;this.onWindowScrollTop(scrollTop);}
if(this._wScrollLeft!==scrollLeft){this._wScrollLeft=scrollLeft;this.onWindowScrollLeft(scrollLeft);}
this._scrolled=false;},onWindowScrollTop:function(){this.updateTableOffset().updateVisibility();},onWindowScrollLeft:function(){this.updateRightCap().updateLeftCap().updateTableScroll();},_onWindowScroll:function(){this._scrolled=true;},_onWindowResize:function(){this._resized=true;},_onTableScroll:function(){this._tableScrolled=true;}});});