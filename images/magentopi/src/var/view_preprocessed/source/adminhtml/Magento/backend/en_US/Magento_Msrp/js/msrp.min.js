define(['jquery','underscore','jquery/ui','mage/dropdown','mage/template'],function($){'use strict';$.widget('mage.addToCart',{options:{showAddToCart:true,submitUrl:'',cartButtonId:'',singleOpenDropDown:true,dialog:{},dialogDelay:500,origin:'',cartForm:'.form.map.checkout',msrpLabelId:'#map-popup-msrp',priceLabelId:'#map-popup-price',popUpAttr:'[data-role=msrp-popup-template]',popupCartButtonId:'#map-popup-button',paypalCheckoutButons:'[data-action=checkout-form-submit]',popupId:'',realPrice:'',isSaleable:'',msrpPrice:'',helpLinkId:'',addToCartButton:'',productName:'',addToCartUrl:''},openDropDown:null,triggerClass:'dropdown-active',popUpOptions:{appendTo:'body',dialogContentClass:'active',closeOnMouseLeave:false,autoPosition:true,closeOnClickOutside:false,'dialogClass':'popup map-popup-wrapper',position:{my:'left top',collision:'fit none',at:'left bottom',within:'body'},shadowHinter:'popup popup-pointer'},popupOpened:false,_create:function(){if(this.options.origin==='msrp'){this.initMsrpPopup();}else if(this.options.origin==='info'){this.initInfoPopup();}else if(this.options.origin==='tier'){this.initTierPopup();}
$(this.options.cartButtonId).on('click',this._addToCartSubmit.bind(this));},initMsrpPopup:function(){var popupDOM=$(this.options.popUpAttr)[0],$msrpPopup=$(popupDOM.innerHTML.trim());$msrpPopup.find(this.options.productIdInput).val(this.options.productId);$('body').append($msrpPopup);$msrpPopup.trigger('contentUpdated');$msrpPopup.find('button').on('click',this.handleMsrpAddToCart.bind(this)).filter(this.options.popupCartButtonId).text($(this.options.addToCartButton).text());$msrpPopup.find(this.options.paypalCheckoutButons).on('click',this.handleMsrpPaypalCheckout.bind(this));$(this.options.popupId).on('click',this.openPopup.bind(this));this.$popup=$msrpPopup;},initInfoPopup:function(){var infoPopupDOM=$('[data-role=msrp-info-template]')[0],$infoPopup=$(infoPopupDOM.innerHTML.trim());$('body').append($infoPopup);$(this.options.helpLinkId).on('click',function(e){this.popUpOptions.position.of=$(e.target);$infoPopup.dropdownDialog(this.popUpOptions).dropdownDialog('open');this._toggle($infoPopup);}.bind(this));this.$popup=$infoPopup;},initTierPopup:function(){var popupDOM=$(this.options.popUpAttr)[0],$tierPopup=$(popupDOM.innerHTML.trim());$('body').append($tierPopup);$tierPopup.find(this.options.productIdInput).val(this.options.productId);this.popUpOptions.position.of=$(this.options.helpLinkId);$tierPopup.find('button').on('click',this.handleTierAddToCart.bind(this)).filter(this.options.popupCartButtonId).text($(this.options.addToCartButton).text());$tierPopup.find(this.options.paypalCheckoutButons).on('click',this.handleTierPaypalCheckout.bind(this));$(this.options.attr).on('click',function(e){this.$popup=$tierPopup;this.tierOptions=$(e.target).data('tier-price');this.openPopup(e);}.bind(this));},handleMsrpAddToCart:function(ev){ev.preventDefault();if(this.options.addToCartButton){$(this.options.addToCartButton).click();this.closePopup(this.$popup);}},handleMsrpPaypalCheckout:function(){this.closePopup(this.$popup);},handleTierAddToCart:function(ev){ev.preventDefault();if(this.options.addToCartButton&&this.options.inputQty&&!isNaN(this.tierOptions.qty)){$(this.options.inputQty).val(this.tierOptions.qty);$(this.options.addToCartButton).click();this.closePopup(this.$popup);}},handleTierPaypalCheckout:function(){if(this.options.inputQty&&!isNaN(this.tierOptions.qty)){$(this.options.inputQty).val(this.tierOptions.qty);this.closePopup(this.$popup);}},openPopup:function(event){var options=this.tierOptions||this.options;this.popUpOptions.position.of=$(event.target);this.$popup.find(this.options.msrpLabelId).html(options.msrpPrice);this.$popup.find(this.options.priceLabelId).html(options.realPrice);this.$popup.dropdownDialog(this.popUpOptions).dropdownDialog('open');this._toggle(this.$popup);if(!this.options.isSaleable){this.$popup.find('form').hide();}},_toggle:function($elem){$(document).on('mouseup.msrp touchend.msrp',function(e){if(!$elem.is(e.target)&&$elem.has(e.target).length===0){this.closePopup($elem);}}.bind(this));$(window).on('resize',function(){this.closePopup($elem);}.bind(this));},closePopup:function($elem){$elem.dropdownDialog('close');$(document).off('mouseup.msrp touchend.msrp');},_addToCartSubmit:function(){this.element.trigger('addToCart',this.element);if(this.element.data('stop-processing')){return false;}
if(this.options.addToCartButton){$(this.options.addToCartButton).click();return false;}
if(this.options.addToCartUrl){$('.mage-dropdown-dialog > .ui-dialog-content').dropdownDialog('close');}
$(this.options.cartForm).submit();}});return $.mage.addToCart;});