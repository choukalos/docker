define(['underscore','mageUtils','../tab'],function(_,utils,Tab){'use strict';var previewConfig={separator:' ',prefix:''};function parsePreview(data){if(typeof data=='string'){data={items:data};}
data.items=utils.stringToArray(data.items);return _.defaults(data,previewConfig);}
return Tab.extend({defaults:{label:'',uniqueNs:'activeCollectionItem',previewTpl:'ui/form/components/collection/preview'},initialize:function(){_.bindAll(this,'buildPreview','hasPreview');return this._super();},initConfig:function(){this._super();this.displayed=[];return this;},initObservable:function(){this._super().observe({noPreview:true,indexed:{}});return this;},initElement:function(elem){this._super().insertToIndexed(elem);return this;},insertToIndexed:function(elem){var indexed=this.indexed();indexed[elem.index]=elem;this.indexed(indexed);return this;},destroy:function(){this._super();this._clearData();},_clearData:function(){this.source.remove(this.dataScope);return this;},formatPreviews:function(previews){return previews.map(parsePreview);},buildPreview:function(data){var preview=this.getPreview(data.items),prefix=data.prefix;return prefix+preview.join(data.separator);},hasPreview:function(data){return!!this.getPreview(data.items).length;},getPreview:function(items){var elems=this.indexed(),displayed=this.displayed,preview;items=items.map(function(index){var elem=elems[index];preview=elem&&elem.visible()?elem.getPreview():'';preview=Array.isArray(preview)?_.compact(preview).join(', '):preview;utils.toggle(displayed,index,!!preview);return preview;});this.noPreview(!displayed.length);return _.compact(items);}});});