define(['jquery','Magento_Braintree/js/view/payment/method-renderer/cc-form','Magento_Braintree/js/validator','Magento_Vault/js/view/payment/vault-enabler','mage/translate'],function($,Component,validator,VaultEnabler,$t){'use strict';return Component.extend({defaults:{template:'Magento_Braintree/payment/form',clientConfig:{id:'co-transparent-form-braintree'},isValidCardNumber:false},initialize:function(){this._super();this.vaultEnabler=new VaultEnabler();this.vaultEnabler.setPaymentCode(this.getVaultCode());return this;},initClientConfig:function(){this._super();this.clientConfig.hostedFields=this.getHostedFields();},getData:function(){var data=this._super();this.vaultEnabler.visitAdditionalData(data);return data;},isVaultEnabled:function(){return this.vaultEnabler.isVaultEnabled();},getHostedFields:function(){var self=this,fields={number:{selector:self.getSelector('cc_number')},expirationMonth:{selector:self.getSelector('expirationMonth'),placeholder:$t('MM')},expirationYear:{selector:self.getSelector('expirationYear'),placeholder:$t('YY')}};if(self.hasVerification()){fields.cvv={selector:self.getSelector('cc_cid')};}
fields.onFieldEvent=function(event){if(event.isEmpty===false){self.validateCardType();}
if(event.type!=='fieldStateChange'){return false;}
if(event.target.fieldKey==='number'){self.selectedCardType(null);}
if(event.target.fieldKey==='number'&&event.card){self.isValidCardNumber=event.isValid;self.selectedCardType(validator.getMageCardType(event.card.type,self.getCcAvailableTypes()));}};return fields;},validateCardType:function(){var $selector=$(this.getSelector('cc_number')),invalidClass='braintree-hosted-fields-invalid';$selector.removeClass(invalidClass);if(this.selectedCardType()===null||!this.isValidCardNumber){$(this.getSelector('cc_number')).addClass(invalidClass);return false;}
return true;},placeOrderClick:function(){if(this.validateCardType()){$(this.getSelector('submit')).trigger('click');}},getVaultCode:function(){return window.checkoutConfig.payment[this.getCode()].ccVaultCode;}});});