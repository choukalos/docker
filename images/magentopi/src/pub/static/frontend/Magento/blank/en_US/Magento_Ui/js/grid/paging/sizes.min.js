define(['ko','underscore','mageUtils','uiElement'],function(ko,_,utils,Element){'use strict';return Element.extend({defaults:{template:'ui/grid/paging/sizes',value:20,minSize:1,maxSize:999,options:{'20':{value:20,label:20},'30':{value:30,label:30},'50':{value:50,label:50},'100':{value:100,label:100},'200':{value:200,label:200}},statefull:{options:true,value:true},listens:{value:'onValueChange',options:'onSizesChange'}},initialize:function(){this._super().updateArray();return this;},initObservable:function(){this._super().track(['value','editing','customVisible','customValue']).track({optionsArray:[]});this._value=ko.pureComputed({read:ko.getObservable(this,'value'),write:function(value){value=this.normalize(value);this.value=value;this._value.notifySubscribers(value);},owner:this});return this;},edit:function(value){this.editing=value;return this;},discardEditing:function(){var value=this.editing;if(value){this.updateSize(value,value);}
return this;},discardAll:function(){this.discardEditing().discardCustom();return this;},getFirst:function(){return this.optionsArray[0].value;},getSize:function(value){return this.options[value];},setSize:function(value){this.value=value;return this;},addSize:function(value){var size;if(!this.hasSize(value)){size=this.createSize(value);this.set('options.'+value,size);}
return this;},removeSize:function(value){if(!this.hasSize(value)){return this;}
this.remove('options.'+value);if(this.isSelected(value)){this.setSize(this.getFirst());}
return this;},updateSize:function(value,newValue){var size=this.getSize(value);if(!size){return this;}
newValue=newValue||size._value;if(isNaN(+newValue)){this.discardEditing();return this;}
newValue=this.normalize(newValue);this.remove('options.'+value).addSize(newValue);if(this.isSelected(value)){this.setSize(newValue);}
return this;},createSize:function(value){return{value:value,label:value,_value:value,editable:true};},hasSize:function(value){return!!this.getSize(value);},discardCustom:function(){this.hideCustom().clearCustom();return this;},showCustom:function(){this.customVisible=true;return this;},hideCustom:function(){this.customVisible=false;return this;},clearCustom:function(){this.customValue='';return this;},applyCustom:function(){var value=this.customValue;value=this.normalize(value);this.addSize(value).setSize(value).discardCustom();return this;},isCustomVisible:function(){return this.customVisible;},normalize:function(value){value=+value;if(isNaN(value)){return this.getFirst();}
return utils.inRange(Math.round(value),this.minSize,this.maxSize);},updateArray:function(){var array=_.values(this.options);this.optionsArray=_.sortBy(array,'value');return this;},isEditing:function(value){return this.editing===value;},isSelected:function(value){return this.value===value;},onValueChange:function(){this.discardAll().trigger('close');},onSizesChange:function(){this.editing=false;this.updateArray();}});});