define(['jquery','underscore','mageUtils','rjsResolver','uiLayout','Magento_Ui/js/modal/alert','mage/translate','uiElement'],function($,_,utils,resolver,layout,alert,$t,Element){'use strict';return Element.extend({defaults:{firstLoad:true,storageConfig:{component:'Magento_Ui/js/grid/data-storage',provider:'${ $.storageConfig.name }',name:'${ $.name }_storage',updateUrl:'${ $.update_url }'},listens:{params:'onParamsChange',requestConfig:'updateRequestConfig'}},initialize:function(){utils.limit(this,'onParamsChange',5);_.bindAll(this,'onReload');this._super().initStorage().clearData();return this;},initStorage:function(){layout([this.storageConfig]);return this;},clearData:function(){this.setData({items:[],totalRecords:0});return this;},setData:function(data){data=this.processData(data);this.set('data',data);return this;},processData:function(data){var items=data.items;_.each(items,function(record,index){record._rowIndex=index;});return data;},reload:function(options){var request=this.storage().getData(this.params,options);this.trigger('reload');request.done(this.onReload).fail(this.onError);return request;},onParamsChange:function(){this.firstLoad?resolver(this.reload,this):this.reload();},onError:function(xhr){if(xhr.statusText==='abort'){return;}
alert({content:$t('Something went wrong.')});},onReload:function(data){this.firstLoad=false;this.setData(data).trigger('reloaded');},updateRequestConfig:function(requestConfig){if(this.storage()){_.extend(this.storage().requestConfig,requestConfig);}}});});