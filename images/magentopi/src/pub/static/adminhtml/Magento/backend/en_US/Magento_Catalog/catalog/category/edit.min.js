define(['jquery','prototype'],function(jQuery){var categorySubmit=function(url,useAjax){var activeTab=$('active_tab_id');if(activeTab){if(activeTab.tabsJsObject&&activeTab.tabsJsObject.tabs('activeAnchor')){activeTab.value=activeTab.tabsJsObject.tabs('activeAnchor').prop('id');}}
var params={};var fields=$('category_edit_form').getElementsBySelector('input','select');for(var i=0;i<fields.length;i++){if(!fields[i].name){continue;}
params[fields[i].name]=fields[i].getValue();}
var categoryId=params['general[id]']?params['general[id]']:0;var isCreating=categoryId==0;var path=params['general[path]'].split('/');var parentId=path.pop();if(parentId==categoryId){parentId=path.pop();}
if(isCreating){if(!tree.currentNodeId){tree.currentNodeId=parentId;}
tree.addNodeTo=parentId;}else{if(tree&&tree.storeId==0){var currentNode=tree.getNodeById(categoryId);if(currentNode){if(parseInt(params['general[is_active]'])){var oldClass='no-active-category';var newClass='active-category';}else{var oldClass='active-category';var newClass='no-active-category';}
Element.removeClassName(currentNode.ui.wrap.firstChild,oldClass);Element.addClassName(currentNode.ui.wrap.firstChild,newClass);}}}
jQuery('#category_edit_form').trigger('submit');};return function(config,element){config=config||{};jQuery(element).on('click',function(event){categorySubmit(config.url,config.ajax);});};});